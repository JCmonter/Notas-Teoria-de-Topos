\chapter{Gavillas sobre Marcos}

Lo que se ha abordado hasta ahora es la teoría de haces y gavillas de conjuntos sobre espacios topológicos. En \cite{Merino2002}, se encargan de trasladar las nociones de morfismo étale y morfismos ultrafinitos a un contexto más general, el de los locales. En este capítulo se presentan algunas de las ideas principales de dicha referencia 
pero viéndolo desde el enfoque de marcos. Para tener más información sobre teoría de marcos, se puede consultar (\textbf{citar las notas de Ángel y bibliografía básica sobre teoría de marcos}).
\section{Marcos y gavillas}

En el sentido categórico, trabajar con locales y trabajar con marcos, en esencia podría parecer lo mismo, ya que la categoría de locales es la categoría opuesta a la categoría de marcos. Sin embargo, en la práctica, trabajar con marcos suele ser más sencillo. 
Lo primero que haremos es dar las herramientas necesarias para trasladar las nociones vistas en capítulos anteriores al lenguaje de marcos.

\begin{definition}
    Un \emph{marco} es una retícula completa $(A, \leq, \bigvee, \wedge, 0, 1)$ que satisface la siguiente propiedad distributiva:
    \[
    a\wedge \bigvee x=\bigvee \{a\wedge b\mid x\in X\}
    \]
    para todo $a\in A$ y $X\subseteq A$.
\end{definition}

\begin{definition}
    Sean $A$ y $B$ dos marcos. Un \emph{morfismo de marcos} es una función monótona $f\colon A\to B$ que preserva
    la estructura de la retícula, es decir, para todo $X\subseteq A$ y $a,b\in A$ se cumple:
    \begin{itemize}
        \item $f(\bigvee X)=\bigvee \{f(x)\mid x\in X\}$.
        \item $f(a\wedge b)=f(a)\wedge f(b)$.
        \item $f(0)=0$ y $f(1)=1$.
    \end{itemize}
\end{definition}

De esta manera, la categoría de marcos $\Frm$ es la categoría cuyos objetos son marcos y cuyos morfismos son morfismos de marcos, y como mencionamos antes, la categoría de locales $\Loc$ es la categoría opuesta a $\Frm$.\\

Si $f:A\to B$ es un morfismo de marcos, entonces $f$ tiene un adjunto derecho $f_*:B\to A$ y cumple la siguiente propiedad:
\[
f(a)\leq b \iff a\leq f_*(b)
\]
para todo $a\in A$ y $b\in B$. De manera general, podemos calcular el adjunto derecho de un morfismo de marcos $f:A\to B$ como:
\[
f_*(b)=\bigvee \{a\in A\mid f(a)\leq b\}
\]

\begin{definition}
Sea $A\in \Frm$. La operación \emph{implicación} (o también conocida como implicación de Heyting), denotada por $(a\succ b)$ para $a, b\in A$, se define por:
\[
a\wedge c \leq b \iff c \leq (a\succ b).
\]
\end{definition}

Consideremos los morfismos de copos $f\colon A\to A$ y $f_*\colon A\to A$, dados por
\[
f(x)=a\wedge x \quad \text{y} \quad f_*(x)=(a\succ x),
\]
entonces $f(x)\leq y$ si y solo si $x\leq f_*(y)$, es decir, $x\wedge a\leq y$ si y solo si $x\leq (a\succ y)$. En otras palabras,
implicar es adjunto derecho de calcular ínfimo. Por lo tanto, la implicación se puede calcular como
\[
(a\succ b)=\bigvee \{x\in A\mid a\wedge x \leq b\}.
\]

El siguiente resultado proporciona algunas propiedades básicas de la implicación.

\begin{prop}
    Consideremos $A$ un marco y $a,b,c\in A$. Entonces 
    \begin{itemize}
        \item $1\succ a=a$.
        \item $a\succ (b\wedge c)=(a\succ b)\wedge (a\succ c)$.
        \item $(a\vee b)\succ c=(a\succ c)\wedge (b\succ c)$.
        \item $a\leq b$ si y solo si $1\leq (a\succ b)$.
        \item $a\leq (b\succ c)$ si y solo si $a\wedge b \leq c$.
    \end{itemize}
\end{prop}

\subsection{Núcleos y cocientes en marcos}
Cuando trabajamos en $\Top$, la noción de subespacio puede ser capturada mediante la noción de sublocal. A su vez, los sublocales pueden ser estudiados de manera 
algebraica mediante lo que en marcos se conoce como \emph{núcleos}. Esta subsección explicara brevemente la relación entre núcleos y sublocales.

\begin{prop}\label{adjunto derecho de nucleo}
    Sea $A$ un marco y $j\in NA$, entonces la inclusión de $A_j$ en $A$ es el adjunto derecho de $j*:A\to A_j$
\end{prop}
\begin{proof}
    Consideremos $x\in A$ y $y\in A_j$, entonces
    $$x\leq y \iff x\leq j*(x)\leq j*(y)=y$$.
\end{proof}

\subsection{Morfismos abiertos}

\begin{definition}[Morfismo abierto]
    Sea $f:A\to B$ un morfismo de marcos. Decimos que es abierto si existe $f_l:B\to A$, un morfismo de copos tal que:
    \begin{itemize}
        \item $f_l\dashv f$.
        \item Para cada $a\in A$ y $b\in B$ se tiene la identidad de Frobenius 
            $$f_l(b\wedge f(a))=f_l(b)\wedge a.$$
    \end{itemize}
\end{definition}

\begin{obs}\label{obs desigualdad Frobenius}
    En general, para cualquier par de morfismos adjuntos $f_l\dashv f$, se cumple una desigualdad de la identidad de Frobenius.
    Sabemos que, por un lado, $b\wedge f(a)\leq b$ y entonces $f_l(b\wedge f(a))\leq f_l(b)$; y por otro lado,
    como $b\wedge f(a)\leq f(a)$, tenemos que $f_l(b\wedge f(a))\leq f_l(f(a))\leq a$; por lo tanto $f_l(b\wedge f(a))\leq f_l(b)\wedge a.$
\end{obs}

\begin{ejp}
    Considere una función $f:S\to T$ continua y abierta, entonces tenemos que el morfismo de marcos $f^{-1}:\mathcal{O}T\to\mathcal{O}S$, dado por la preimagen, es un morfismo abierto.
    Pues ya al ser la función abierta, tenemos que el morfismo de copos $f:\mathcal{O}S\to\mathcal{O}T$, dado por la imagen directa, es adjunto izquierdo de $f^{-1}$, ya que
    $$f(U)\subseteq V \iff U\subseteq f^{-1}(V)$$
    para todo $U\in\mathcal{O}S$ y $V\in\mathcal{O}T$. Además satisface la identidad de Frobenius
    $$f(U\cap f^{-1}(V))=f(U)\cap V$$
\end{ejp}

\begin{ejp}
    Consideremos un marco $A$ y un elemento $a\in A$, entonces el morfismo de marcos $a\wedge -:A\to \downarrow a$ es un morfismo abierto. Veamos que la inclusión
    de la sección inferior en el marco, es su adjunto izquierdo: Ya que para $x\in A$ y $y\in\downarrow a$ siempre se tiene que 
    $$y\leq a\wedge x \iff y\leq x $$
    Y satisface Frobenius, pues
    $$y\wedge(a\wedge x)=(y\wedge a)\wedge x=y\wedge x$$
\end{ejp}

\begin{lema}\label{nucleo abierto iff paso al cociente abierto}
    Sea $A$ un marco y $j:A\to A$ un núcleo del marco. Entonces $j$ es un núcleo abierto si y solo si el morfismo de marcos $j^*:A\to A_j$ es un morfismo abierto.
\end{lema}

\begin{proof}
    Si $j$ es abierto, entonces existe un elemento $a\in A$ tal que $j=v_a$, veamos entonces que $v_a^*:A\to A_{v_a}$ es un morfismo abierto. Es claro que su adjunto izquierdo
    es $a\wedge -:A_{v_a}\to A$, por la misma definición de la implicación. Y por otro lado, veamos que satisface Frobenius, pues para $x\in A$ y $y\in A_{v_a}$ tenemos
    $$a\wedge(y\wedge v_a(x))=(a\wedge(a\succ x))\wedge y=(a\wedge x)\wedge y = x\wedge(a\wedge y).$$
    Por lo tanto $v_a^*$ es un morfismo abierto.

    Por otro lado supongamos que $j^*$ es un morfismo abierto, por lo tanto existe $j_l:A_j\to A$ tal que $j_l\dashv j^*$ y $j_l(y\wedge j^*(x))=j_l(y)\wedge x$ para 
    todo $x\in A$ y $y\in A_j$. Definamos $a:=f_l(1)$ y notemos que dado $x\in A_j$ tenemos que 
    $$j_l(x)=j_l(j^*(x))=j_l(j^*(x)\wedge 1)=x\wedge j_l(1)$$
    por lo tanto $j_l=a\wedge -$ y como los adjuntos son únicos, al ser la implicación su adjunto derecho, tenemos que $j^*=a\succ - = v_a^*$, lo que significa que $j$
    es un núcleo abierto.
\end{proof}

\begin{prop}\label{nucleo de morfismo abierto, es abierto}
    Sea $f:A\to B$ un morfismo de marcos abierto. Entonces el núcleo $k=f_*f$ es un núcleo abierto.
\end{prop}

\begin{proof}
    Usaremos el lema anterior (\ref{nucleo abierto iff paso al cociente abierto}), y veamos que $k^*:A\to A_k$ es un morfismo abierto. Para esto, consideremos que $f$
    es un morfismo abierto y por lo tanto existe $f_l\dashv f$ que satisface Frobenius. Ahora definamos el morfismo $k_l: A_k\to A$ como $k_l(y):=f_l(f(y))$ y veamos que son adjuntos.

    Sean $x\in A$ y $y\in A_k$, entonces
    $$ y\leq k^*(x)=f_*(f(x)) \iff f(y)\leq f(x) \iff k_l(y)=f_l(f(y))\leq x$$
    ya que $f_l\dashv f\dashv f_*$. Luego veamos que $k_l$ satisface Frobenius, pues
    $$k_l(k^*(x)\wedge y)=f_l(f(k^*(x)\wedge y))=f_l(ff_*f(x)\wedge f(y))=f_l(f(x)\wedge f(y))=x\wedge f_l(f(y))=x\wedge k_l(y)$$
    considerando propiedades de morfismos adjuntos y que $f_l$ ya satisface Frobenius.
\end{proof}

\begin{theo}\label{Teo Joyal-Tierney}
    Sea $f:A\to B$ un morfismo de marcos, entonces $f$ es un morfismo abierto
    si y solo si $f$ preserva ínfimos arbitrarios y $f(x\succ y)=f(x)\succ f(y)$
    para todo $x,y\in A$
\end{theo}
\begin{proof}
    Supongamos que $f$ es un morfismo abierto, entonces existe $f_l:B\to A$ tal que $f_l\dashv f$ y satisface Frobenius.

    Como $f$ tiene adjunto adjunto izquierdo, entonces preserva ínfimos arbitrarios. Para probar que abre implicaciones
    consideremos $x,y\in A$ y notemos que 
    $$(x\succ y)\wedge x\leq y \implies f((x\succ y)\wedge x)\leq f(y) \implies f(x\succ y)\wedge f(x)\leq f(y)$$
    y por un lado, por ser la implicación adjunto derecho de sacar ínfimo, tenemos $f(x\succ y)\leq f(x)\succ f(y)$. Por otro lado
    podemos aplicar el adjunto izquierdo
    $$f(x\succ y)\wedge f(x)\leq f(y) \implies f_l(f(x\succ y)\wedge f(x))\leq f_l(f(y))\leq y$$
    recordando que aplicar el adjunto derecho seguido del adjunto izquierdo desinfla. Y como $f_l$ satisface Frobenius tenemos
    $$f_l(f(x\succ y))\wedge x\leq y \implies f_l(f(x\succ y))\leq x\succ y$$
    lo que por fórmula de adjunción nos da que es equivalente a $f(x\succ y)\leq f(x\succ y)$; probando que $f$ abre implicaciones.

    Ahora supongamos que $f$ preserva ínfimos arbitrarios y preserva implicaciones. Como preserva ínfimos entonces tiene adjunto izquierdo
    $f_l$. Para ver que satisface Frobenius necesitamos probar que $f_*(b\succ f(a))=f_l(b)\succ a$ para cada $a\in A$ y $b\in B$.
    Sabemos que $b\leq f(f_l(b))$, luego como dejar fija la segunda entrada en una implicación es un morfismo antítono, tenemos
    $f(f_l(b))\succ f(a)\leq b\succ f(a)$, y considerando que $f$ abre implicaciones y la fórmula de adjunción para $f\dashv f_*$ entonces
    $$f(f_l(b)\succ a)\leq b\succ f(a) \implies f_l(b)\succ a\leq f_*(b\succ f(a))$$
    Por otro lado veamos que 
    $$b\succ f(a)\leq b\succ f(a) \implies (b\succ f(a))\wedge b\leq f(a) \implies b\leq (b\succ f(a))\succ f(a)$$
    entonces, considerando que $f$ abre supremos, propiedades de adjunción y en que condiciones la implicación es antítona, tenemos
    $$b\leq (b\succ f(a))\succ f(a)\leq  ff_*(b\succ f(a))\succ f(a)=f(f_*(b\succ f(a))\succ a)$$
    por último, aplicando la fórmula de adjunción y propiedades de la implicación
    $$f_l(b)\leq f_*(b\succ f(a))\succ a \implies f_l(a)\wedge f_*(b\succ f(a))\leq a \implies f_*(b\succ f(a))\leq f_l(b)\succ a$$
    lo que nos da la igualdad que deseábamos.

    Para la identidad de Frobenius, recordemos que es suficiente probar la desigualdad $f_l(b)\wedge a\leq f_l(b\wedge f(a))$ (Observación \ref{obs desigualdad Frobenius} ),
    o equivalentemente, $a\leq f_l(b)\succ f_l(b\wedge f(a))$, por lo que probaremos lo segundo:
    \begin{eqnarray*}
        f_l(b)\succ f_l(b\wedge f(a)) &=& f_*(b\succ ff_l(b\wedge f(a))) \\
                                    &\geq& f_*(b\succ(b\wedge f(a)))=f_*((b\succ b)\wedge(b\wedge f(a)))\\
                                    &=& f_*(b\succ f(a))=f_l(b)\succ a\geq a
    \end{eqnarray*}
\end{proof}

\begin{lema}
    La composición de morfismos de marcos abiertos es un morfismo abierto.
\end{lema}

\begin{proof}
    Sean $A\xrightarrow{f}B\xrightarrow{g}C\in\Frm$ dos morfismos abiertos. Del teorema anterior (\ref{Teo Joyal-Tierney}) ambos morfismos preservan implicaciones e ínfimos arbitrarios.
    Es claro que entonces la composición $g\circ f$ también preserva implicaciones e ínfimos arbitrarios, por lo tanto es un morfismo abierto.
\end{proof}

\begin{lema}
    Sea una familia $\{f_i:A\to A_i\}_{i\in I}\subseteq\Frm$ de morfismos abiertos. Entonces el morfismo $f:A\to\prod_{i\in I} A_i$, inducido por la propiedad universal
    del producto, es un morfismo abierto.
\end{lema}

\begin{proof}
    Definamos $f_l:\prod_{i\in I} A_i\to A$ como $f_l((a_i)_{i\in I})=\bigvee_{i\in I}f_{il}(a_i)$ para cada $(a_i)_{i\in I}\in\prod_{i\in I} A_i$, donde $f_{il}\dashv f_i$ y satisface Frobenius para cada $i\in I$ (ya que cada $f_i$ es abierto).
    Veamos que es el adjunto izquierdo, sean $(a_i)_{i\in I}\in\prod_{i\in I} A_i$ y $a\in A$, entonces
    \begin{eqnarray*}
        f_l((a_i)_{i\in I})\leq a &\iff& \bigvee_{i\in I}f_{il}(a_i)\leq a \\
                                    &\iff& f_{il}(a_i)\leq a \ \ \forall i\in I \\
                                    &\iff& a_i\leq f_i(a) \ \ \forall i\in I \\
                                    &\iff& (a_i)_{i\in I}\leq (f_i(a))_{i\in I}=f(a) 
    \end{eqnarray*}
    lo que prueba que $f_l\dashv f$. Y para la identidad de Frobenius, notemos que
    \begin{eqnarray*}
        f_l((a_i)_{i\in I}\wedge f(a)) &=& f_l((a_i)_{i\in I}\wedge(f_i(a))_{i\in I})=f_l((a_i\wedge f_i(a))_{i\in I}) \\ 
                                        &=& \bigvee_{i\in I}f_{il}(a_i\wedge f_i(a))=\bigvee_{i\in I}(f_{il}(a_i)\wedge a) \\ 
                                        &=& \bigvee_{i\in I}f_{il}(a_i)\wedge a = f_l((a_i)_{i\in I})\wedge a
    \end{eqnarray*}
\end{proof}

\subsection{Morfismos étales}

\begin{lema}
    Sea $f:A\to B$ un morfismo de marcos, $a\in A$, $b\in B$ y $g:\downarrow a\to \downarrow b$ otro morfismo de marcos tal que 
    el cuadrado \begin{tikzcd}
        A & B \\
        {\downarrow a} & {\downarrow b}
        \arrow["f", from=1-1, to=1-2]
        \arrow["{a\wedge-}"', from=1-1, to=2-1]
        \arrow["{b\wedge-}", from=1-2, to=2-2]
        \arrow["g"', from=2-1, to=2-2]
    \end{tikzcd} conmuta, entonces $g(x)=b\wedge f(x)$ para todo $x\leq a$ y $g_*(y)=f_*(b\succ y)\wedge a$ para todo $y\leq b$.
\end{lema}
\begin{proof}
    Sea $x\leq a$, entonces:
    $$g(x)=g(a\wedge x)=b\wedge f(x)$$
    ya que el diagrama conmuta. Por otro lado sea $y\leq b$, entonces:
    $$f_*(b\succ y)=f_*\circ (b\wedge-)_*(y)=(a\wedge-)_*\circ g_*(y)=a\succ g_*(y)$$
    ya que si el cuadrado conmuta, entonces conmuta el cuadrado de los respectivos adjuntos derechos.
    
    De lo anterior, por un lado tenemos que $f_*(b\succ y)\wedge a\leq g_*(y)$. Por otro lado, notemos que $g_*(y)\leq a$,
    y por lo obtenido previamente, tenemos que $b\wedge f(g_*(y))=g(g_*(y))\leq y$ (Esta última desigualdad porque $g\dashv g_*$).
    Luego eso es equivalente a que $f(g_*(y))\leq b\succ y$ (Por ser la implicación el adjunto derecho de sacar ínfimo), y por último
    $g_*(y)\leq f_*(b\succ y)$ (ya que $f\dashv f_*)$. Y por lo tanto $g_*(y)=f_*(b\succ y)\wedge a$.
\end{proof}

\begin{lema}
    Sea $f:A\to B$ un morfismo de marcos, $a\in A$, $b\in B$ y $g:A_{v_a}\to B_{v_b}$ otro morfismo de marcos tal que 
    el cuadrado \begin{tikzcd}
        A & B \\
        {A_{v_a}} & {B_{v_b}}
        \arrow["f", from=1-1, to=1-2]
        \arrow["{v_a}"', from=1-1, to=2-1]
        \arrow["{v_b}", from=1-2, to=2-2]
        \arrow["g"', from=2-1, to=2-2]
    \end{tikzcd} conmuta, entonces $g(x)=b\succ f(x)$ para todo $x\in A_{v_a}$ y $g_*(y)=f_*(y)$ para todo $y\in B_{v_b}$.
\end{lema}

\begin{proof}
    Sea $x\in A_{v_a}$, considerando que $x$ también es elemento de $A$ y el hecho de que conmuta el cuadrado de la hipótesis, entonces tenemos
    $$b\succ f(x) = g(a\succ x)=g(x)$$

    Para el adjunto derecho, consideremos la proposición \ref{adjunto derecho de nucleo}, y que el cuadrado de la hipótesis conmuta. Entonces también lo hace el cuadrado de los adjuntos
    derechos y por lo tanto
    $$g_*(y)= f_*(y)$$
\end{proof}

\section{Algunas equivalencias importantes}

\subsection{$\Et/A\cong\Gav(A)$}

\subsection{$\Con(A)\cong \Gav(A)$}

\subsection{Topos localico}
